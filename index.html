<!DOCTYPE html>
<html>

<head>
  <title>C칩digo Morse</title>
  <meta charset="utf-8">

  <!-- Adicionando a biblioteca Twitter Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css">

  <style>
    .container {
      max-width: 600px;
      margin: 0 auto;
      padding-top: 50px;
    }

    h1 {
      text-align: center;
      margin-bottom: 30px;
    }

    input[type="text"] {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border-radius: 10px;
      border: none;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
      margin-bottom: 20px;
    }

    #pontuacao {
      font-size: 24px;
      font-weight: bold;
      text-align: center;
      margin-bottom: 50px;
    }

    @keyframes explode {
      from {
        transform: scale(1);
        opacity: 1;
      }

      to {
        transform: scale(3);
        opacity: 0;
      }
    }

    .firework-particle {
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: #ff0;
      animation: explode 0.5s linear;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>C칩digo Morse</h1>
    <div id="firework-container"></div>
    <p>Funciona assim: Digite uma letra e aperte enter para saber se acertou!:</p>
    <input type="text" id="fraseMorse">
    <div id="pontuacao">Pontua칞칚o: 0</div>
    <h1>
      <pre><div id="tabela" style="font-family: Arial;">tabela</div></pre>
    </h1>
    <label for="volume-control">Volume:</label><br/>
    <input type="range" id="volume-control" min="0" max="1" step="0.01" value="0.5">
    <br/>
    <br/>
    <label for="volume-control">Frequ칡ncia:</label><br/>
    <input type="range" id="frequencia-control" min="0" max="1" step="0.01" value="0.5">



  </div>

  <script>

    const morseCode = {
      'a': '.-', 'b': '-...', 'c': '-.-.', 'd': '-..',
      'e': '.', 'f': '..-.', 'g': '--.', 'h': '....',
      'i': '..', 'j': '.---', 'k': '-.-', 'l': '.-..',
      'm': '--', 'n': '-.', 'o': '---', 'p': '.--.',
      'q': '--.-', 'r': '.-.', 's': '...', 't': '-',
      'u': '..-', 'v': '...-', 'w': '.--', 'x': '-..-',
      'y': '-.--', 'z': '--..', '0': '-----', '1': '.----',
      '2': '..---', '3': '...--', '4': '....-', '5': '.....',
      '6': '-....', '7': '--...', '8': '---..', '9': '----.'
    };
    // Inicializando a pontua칞칚o
    let pontos = 0;



    // Obtendo a caixa de texto e a div da pontua칞칚o
    const inputFrase = document.getElementById("fraseMorse");
    const divPontuacao = document.getElementById("pontuacao");

    var frase = "0";


    // Adicionando um listener para o evento "keyup" na caixa de texto
    inputFrase.addEventListener("keyup", async function (event) {
      
      if (event.key === "Enter") { // Se o Enter foi pressionado
        var inputfraseMorse = document.getElementById("fraseMorse");
        if( inputfraseMorse.readOnly == true){
          exit;
        }
        inputfraseMorse.readOnly = true;
        const fraseDigitada = inputFrase.value.trim(); // Obtendo o valor da caixa de texto e removendo espa칞os em branco
        if (fraseDigitada === frase) { // Se a frase digitada for igual  frase em Morse
          pontos++; // Incrementa a pontua칞칚o
          divPontuacao.innerText = "Pontua칞칚o: " + pontos + " 游땎"; // Atualiza o texto da div da pontua칞칚o
          const container = document.getElementById("firework-container");

          continuaAnimacao=true;
          createFireworkInterval(container);
          

        } else {
          pontos = pontos * 90 / 100;
          pontos = pontos.toFixed(1);
          divPontuacao.innerText = "Pontua칞칚o: " + pontos + " 游뱎"; // Atualiza o texto da div da pontua칞칚o
          continuaAnimacao=false;
        }
        inputFrase.value = ""; // Limpa a caixa de texto
        await fraseAleatorio();
        inputfraseMorse.readOnly = false;

      }
      desenhaTabela();
    });




    function beep(t, f) {
      return new Promise(function (resolve, reject) {
        var audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        // Create a GainNode for volume control
        var gainNode = audioCtx.createGain();
        var volumeControl = document.getElementById("volume-control");
        gainNode.gain.value = volumeControl.value;

        var oscillator = audioCtx.createOscillator();
        oscillator.type = "triangle";

        var frequenciaControl = document.getElementById("frequencia-control").value;
        oscillator.frequency.value = f*frequenciaControl;

        // Connect the oscillator to the GainNode and the GainNode to the destination
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        oscillator.start();
        oscillator.stop(audioCtx.currentTime + t / 1000);

        // Update volume when the user moves the volume control

        volumeControl.addEventListener("input", function () {
          gainNode.gain.value = volumeControl.value;
        });

        // Libera a inst칙ncia de 치udio ap칩s a reprodu칞칚o
        oscillator.onended = function () {
          oscillator.disconnect();
          gainNode.disconnect();
          audioCtx.close();
          resolve();
        };
      });
    }







    // fun칞칚o que reproduz um caractere morse com a unidade de tempo e frequ칡ncia especificadas
    async function playMorse(char, timeUnit, frequency) {
      var beepTime = timeUnit * 3;

      var dot = timeUnit;
      var dash = timeUnit * 3;
      var pauseTime = timeUnit * 3;

      switch (char) {
        case '.':
          await beep(dot, frequency);
          await beep(dot, 0);
          break;
        case '-':
          await beep(dash, frequency);
          await beep(dot, 0);
          break;
        case ' ':
          await beep(pauseTime, 0);
          await beep(dot, 0);
          break;
        default:
          console.log('Invalid Morse character: ' + char);
      }
    }




    async function playMorseForLetter(letter) {


      const letterLowerCase = letter.toLowerCase();
      const morseChar = morseCode[letterLowerCase];

      if (morseChar) {
        for (let i = 0; i < morseChar.length; i++) {
          await playMorse(morseChar[i], 107, 450);
        }
      } else {

      }
    }


    async function playFrase(frase) {
      for (var i = 0; i < frase.length; i++) {
        var letter = frase[i];
        await playMorseForLetter(letter);
        await playMorseForLetter(' ');

      }
    }



    async function fraseAleatorio() {
      const subMorseCode = Object.entries(morseCode).slice(0, pontos + 1);
      const letras = Object.values(subMorseCode);
      //const letraEscolhida = letras[Math.floor(Math.random() * letras.length)].key;
      const letraEscolhida =  Object.values(subMorseCode)[parseInt(Math.random() * letras.length)][0];
     
      frase = letraEscolhida;
      await playFrase(letraEscolhida);

    }
    async function jogoMorse() {
      // Escolhe uma letra aleat칩ria do objeto morseCode
      const letras = Object.keys(morseCode);
      const letraEscolhida = letras[Math.floor(Math.random() * letras.length)];

      // Toca o 치udio correspondente  letra escolhida
      const codigo = morseCode[letraEscolhida];
      console.log('caracter escolhido: ' + letraEscolhida);
      await playFrase(letraEscolhida);

      // Espera o usu치rio digitar uma letra
      //const letraDigitada = prompt('Digite a letra correspondente ao c칩digo Morse tocado:');

      // Verifica se o usu치rio acertou
      //if (letraDigitada === letraEscolhida) {
      //  console.log('Acertou!');
      //} else {
      //  console.log('Errou!');
      //}
    }


    function desenhaTabela() {
      const tabela = document.getElementById("tabela");
      var texto = "";

      var i = 0;
      for (let letra in morseCode) {
        const codigoMorse = morseCode[letra];
        texto += letra + ")\t" + codigoMorse + "\t";
        i++;
        if(i>pontos){
          break;
        }
        if (i % 3 == 0) {
          texto += "\n";
        }

      }

      tabela.innerText = texto;

    }
    desenhaTabela();


    function createFirework(x, y, container) {
      const particleCount = 30;
      const angleIncrement = (2 * Math.PI) / particleCount;
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement("div");
        particle.classList.add("firework-particle");
        container.appendChild(particle);
        const angle = i * angleIncrement;
        const speed = 0.2 + Math.random() * 0.5;
        const vx = Math.sin(angle) * speed;
        const vy = Math.cos(angle) * speed;
        const particleAnimation = particle.animate(
          [
            { transform: `translate(${x}px, ${y}px)` },
            { transform: `translate(${x + vx * 100}px, ${y + vy * 100}px)` },
          ],
          {
            duration: 1000,
            easing: "ease-out",
          }
        );
        particleAnimation.onfinish = () => particle.remove();
      }
    }
    var continuaAnimacao = true;
    function createFireworkInterval(container) {
      const x = Math.random() * container.clientWidth;
      const y = Math.random() * container.clientHeight;
      createFirework(x, y, container);
      if (continuaAnimacao==true) {
        setTimeout(() => createFireworkInterval(container), 1000 + Math.random() * 2000);
      }
    }



  </script>

  <script src="https://code.jquery.com/jquery-1.11.3.js"></script>
  <!-- Adicionando o script da biblioteca Twitter Bootstrap -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"></script>
</body>

</html>